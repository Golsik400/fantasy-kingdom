<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Fantasy Kingdom MMO</title>
<style>
body { font-family: Arial; background:#111; color:#eee }
button { margin:5px }
.card { border:1px solid #444; padding:10px; margin:10px }
</style>
</head>
<body>

<button id="login">Zaloguj</button>

<div id="game" style="display:none">

<h2 id="name"></h2>
<div id="shield"></div>

<div class="card">
<h3>ğŸ“¦ Surowce</h3>
ğŸŒ² <span id="wood"></span>
ğŸª¨ <span id="stone"></span>
ğŸ’ <span id="gold"></span>
</div>

<div class="card">
<h3>âš”ï¸ Armia</h3>
<div id="army"></div>
</div>

<div class="card">
<h3>ğŸ—ºï¸ Mapa</h3>
Pozycja: <span id="pos"></span>
</div>

<div class="card">
<h3>âš”ï¸ PvP</h3>
<select id="targets"></select>
<button onclick="attack()">Atakuj</button>
<div id="log"></div>
</div>

<div class="card">
<h3>ğŸ† Ranking</h3>
<ol id="ranking"></ol>
</div>

<div class="card">
<h3>ğŸ’ Sklep premium</h3>
<button onclick="boost()">Przyspiesz produkcjÄ™ (1ğŸ’)</button>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, set, get, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const app = initializeApp({
 apiKey:"AIzaSy...",
 authDomain:"fantasy-kingdom-70acd.firebaseapp.com",
 databaseURL:"https://fantasy-kingdom-70acd-default-rtdb.firebaseio.com",
 projectId:"fantasy-kingdom-70acd"
});

const auth = getAuth(app);
const db = getDatabase(app);
const provider = new GoogleAuthProvider();
const $ = i=>document.getElementById(i);

$("login").onclick=()=>signInWithPopup(auth,provider);

const unitPower=(tier)=>Math.pow(1.3,tier);

function armyPower(a){
 let p=0;
 for(let k in a) p+=a[k].count*unitPower(a[k].tier);
 return p;
}

window.attack=async()=>{
 const t=$("targets").value;
 const u=auth.currentUser.uid;
 if(!t||t===u)return;

 const A=(await get(ref(db,"players/"+u))).val();
 const D=(await get(ref(db,"players/"+t))).val();

 if(Date.now()<D.shield)return alert("Gracz chroniony");

 const pA=armyPower(A.army);
 const pD=armyPower(D.army);

 if(pA>pD){
  await update(ref(db,"players/"+u+"/resources"),{
   wood:A.resources.wood+50,
   stone:A.resources.stone+50
  });
  $("log").innerText="ZwyciÄ™stwo!";
 }else{
  $("log").innerText="PoraÅ¼ka!";
 }
};

window.boost=async()=>{
 const u=auth.currentUser.uid;
 const r=ref(db,"players/"+u);
 const d=(await get(r)).val();
 if(d.resources.gold<1)return;
 await update(r,{
  "resources/gold":d.resources.gold-1,
  boost:Date.now()+600000
 });
};

onAuthStateChanged(auth,async u=>{
 if(!u)return;
 const r=ref(db,"players/"+u.uid);
 if(!(await get(r)).exists()){
  await set(r,{
   name:u.displayName,
   created:Date.now(),
   shield:Date.now()+86400000,
   pos:{x:Math.floor(Math.random()*100),y:Math.floor(Math.random()*100)},
   resources:{wood:300,stone:200,gold:5},
   army:{
    assassin:{count:10,tier:1},
    tank:{count:5,tier:1}
   }
  });
 }
 const d=(await get(r)).val();
 $("game").style.display="block";
 $("name").innerText=d.name;
 $("wood").innerText=d.resources.wood;
 $("stone").innerText=d.resources.stone;
 $("gold").innerText=d.resources.gold;
 $("pos").innerText=`${d.pos.x}:${d.pos.y}`;
 if(Date.now()<d.shield) $("shield").innerText="ğŸ›¡ï¸ Ochrona aktywna";

 onValue(ref(db,"players"),s=>{
  $("targets").innerHTML="";
  $("ranking").innerHTML="";
  const arr=[];
  s.forEach(p=>{
   if(p.key!==u.uid){
    let o=document.createElement("option");
    o.value=p.key;o.text=p.val().name;
    $("targets").appendChild(o);
   }
   arr.push({n:p.val().name,p:armyPower(p.val().army)});
  });
  arr.sort((a,b)=>b.p-a.p).slice(0,10)
   .forEach(x=>{
    let li=document.createElement("li");
    li.innerText=`${x.n} (${Math.floor(x.p)})`;
    $("ranking").appendChild(li);
   });
 });
});
</script>
</body>
</html>



























