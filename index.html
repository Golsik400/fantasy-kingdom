<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fantasy Kingdom MMO</title>

<style>
body{font-family:Arial;background:#111;color:#eee}
.card{border:1px solid #444;padding:10px;margin:10px}
input,button,select{margin:3px}
#chat{height:150px;overflow:auto;background:#000;padding:5px}
.msg{font-size:13px}
</style>
</head>
<body>

<button id="login">Zaloguj</button>

<div id="game" style="display:none">

<h2 id="name"></h2>
<div id="event"></div>

<div class="card">
<h3>ğŸ“¦ Surowce</h3>
ğŸŒ² <span id="wood"></span>
ğŸª¨ <span id="stone"></span>
ğŸ’ <span id="gold"></span>
</div>

<div class="card">
<h3>ğŸ’¬ Czat globalny</h3>
<div id="chat"></div>
<input id="chatInput" placeholder="Napisz..." />
<button onclick="sendMsg()">WyÅ›lij</button>
</div>

<div class="card">
<h3>ğŸ° Klan</h3>
<div id="clanInfo">Brak klanu</div>
<input id="clanName" placeholder="Nazwa klanu">
<button onclick="createClan()">UtwÃ³rz</button>
<select id="clanList"></select>
<button onclick="joinClan()">DoÅ‚Ä…cz</button>
</div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, set, get, push, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const app = initializeApp({
 apiKey:"AIzaSyChxX62dEqlQ4ZVexsp7MEtV2ZD7EiGWrs",
 authDomain:"fantasy-kingdom-70acd.firebaseapp.com",
 databaseURL:"https://fantasy-kingdom-70acd-default-rtdb.firebaseio.com",
 projectId:"fantasy-kingdom-70acd"
});

const auth=getAuth(app);
const db=getDatabase(app);
const provider=new GoogleAuthProvider();
const $=i=>document.getElementById(i);

$("login").onclick=()=>signInWithPopup(auth,provider);

/* ğŸ’¬ CHAT */
window.sendMsg=async()=>{
 const txt=$("chatInput").value;
 if(!txt)return;
 await push(ref(db,"chat"),{
  name:auth.currentUser.displayName,
  text:txt,
  time:Date.now()
 });
 $("chatInput").value="";
};

/* ğŸ° KLAN */
window.createClan=async()=>{
 const name=$("clanName").value;
 if(!name)return;
 const cRef=ref(db,"clans/"+name);
 const snap=await get(cRef);
 if(snap.exists())return alert("Klan istnieje");
 await set(cRef,{
  leader:auth.currentUser.uid,
  members:{[auth.currentUser.uid]:auth.currentUser.displayName}
 });
 await update(ref(db,"players/"+auth.currentUser.uid),{clan:name});
};

window.joinClan=async()=>{
 const name=$("clanList").value;
 const cRef=ref(db,"clans/"+name);
 const c=(await get(cRef)).val();
 if(Object.keys(c.members).length>=100)return alert("Klan peÅ‚ny");
 await update(cRef.child("members"),{
  [auth.currentUser.uid]:auth.currentUser.displayName
 });
 await update(ref(db,"players/"+auth.currentUser.uid),{clan:name});
};

/* ğŸ‰ EVENT */
const eventActive=true;
const eventBonus=2;

/* START */
onAuthStateChanged(auth,async u=>{
 if(!u)return;
 const pRef=ref(db,"players/"+u.uid);
 if(!(await get(pRef)).exists()){
  await set(pRef,{
   name:u.displayName,
   resources:{wood:300,stone:200,gold:5},
   clan:null
  });
 }

 const d=(await get(pRef)).val();
 $("game").style.display="block";
 $("name").innerText=d.name;
 $("wood").innerText=d.resources.wood;
 $("stone").innerText=d.resources.stone;
 $("gold").innerText=d.resources.gold;
 if(eventActive)$("event").innerText="ğŸ‰ EVENT: +100% produkcji";

 /* CHAT */
 onValue(ref(db,"chat"),s=>{
  $("chat").innerHTML="";
  s.forEach(m=>{
   let div=document.createElement("div");
   div.className="msg";
   div.innerText=`${m.val().name}: ${m.val().text}`;
   $("chat").appendChild(div);
  });
 });

 /* KLAN LISTA */
 onValue(ref(db,"clans"),s=>{
  $("clanList").innerHTML="";
  s.forEach(c=>{
   let o=document.createElement("option");
   o.value=c.key;o.text=c.key;
   $("clanList").appendChild(o);
  });
 });

 if(d.clan)$("clanInfo").innerText="Klan: "+d.clan;
});
</script>
</body>
</html>





























