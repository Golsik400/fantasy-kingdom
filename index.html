<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Fantasy Kingdom</title>
</head>
<body>

<button id="loginBtn">Zaloguj siÄ™</button>

<div id="game" style="display:none;">
<h2 id="playerName"></h2>

<h3>ğŸ“¦ Surowce</h3>
ğŸŒ² <span id="wood">0</span>
ğŸª¨ <span id="stone">0</span>
ğŸ’ <span id="gold">0</span>

<hr>

<h3>âš”ï¸ Twoja armia</h3>
A: <span id="a_assassin">0</span>
T: <span id="a_tank">0</span>
Å: <span id="a_archer">0</span>
K: <span id="a_cavalry">0</span>
L: <span id="a_flying">0</span>

<hr>

<h3>ğŸŒ PvP â€“ Inni gracze</h3>
<select id="target"></select>
<button onclick="attackPlayer()">Atakuj</button>

<div id="battleLog"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, get, set, update, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyChxX62dEqlQ4ZVexsp7MEtV2ZD7EiGWrs",
  authDomain: "fantasy-kingdom-70acd.firebaseapp.com",
  databaseURL: "https://fantasy-kingdom-70acd-default-rtdb.firebaseio.com",
  projectId: "fantasy-kingdom-70acd"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);
const provider = new GoogleAuthProvider();
const $ = id => document.getElementById(id);

$("loginBtn").onclick = () => signInWithPopup(auth, provider);

/* ğŸ§® SIÅA */
const power = {
  assassin: 2,
  tank: 5,
  archer: 3,
  cavalry: 4,
  flying: 8
};

const armyPower = a =>
  a.assassin*2 + a.tank*5 + a.archer*3 + a.cavalry*4 + a.flying*8;

/* âš”ï¸ ATAK */
window.attackPlayer = async () => {
  const attacker = auth.currentUser;
  const targetId = $("target").value;
  if (!targetId || attacker.uid === targetId) return;

  const refA = ref(db, "players/" + attacker.uid);
  const refD = ref(db, "players/" + targetId);

  const A = (await get(refA)).val();
  const D = (await get(refD)).val();

  const pA = armyPower(A.army);
  const pD = armyPower(D.army);

  if (pA <= 0 || pD <= 0) {
    $("battleLog").innerText = "Jedna z armii jest pusta.";
    return;
  }

  if (pA >= pD) {
    // WYGRANA ATAKUJÄ„CEGO
    const stolenWood = Math.floor(D.resources.wood * 0.2);
    const stolenStone = Math.floor(D.resources.stone * 0.2);

    await update(refA, {
      "resources/wood": A.resources.wood + stolenWood,
      "resources/stone": A.resources.stone + stolenStone
    });

    await update(refD, {
      "resources/wood": D.resources.wood - stolenWood,
      "resources/stone": D.resources.stone - stolenStone,
      "army/assassin": Math.floor(D.army.assassin * 0.7),
      "army/tank": Math.floor(D.army.tank * 0.7),
      "army/archer": Math.floor(D.army.archer * 0.7),
      "army/cavalry": Math.floor(D.army.cavalry * 0.7),
      "army/flying": Math.floor(D.army.flying * 0.7)
    });

    $("battleLog").innerText = "ZwyciÄ™stwo! Zrabowano surowce.";
  } else {
    // PORAÅ»KA ATAKUJÄ„CEGO
    await update(refA, {
      "army/assassin": Math.floor(A.army.assassin * 0.7),
      "army/tank": Math.floor(A.army.tank * 0.7),
      "army/archer": Math.floor(A.army.archer * 0.7),
      "army/cavalry": Math.floor(A.army.cavalry * 0.7),
      "army/flying": Math.floor(A.army.flying * 0.7)
    });

    $("battleLog").innerText = "PoraÅ¼ka! StraciÅ‚eÅ› wojsko.";
  }

  location.reload();
};

/* ğŸ‘¤ START */
onAuthStateChanged(auth, async (user) => {
  if (!user) return;

  const refP = ref(db, "players/" + user.uid);
  let snap = await get(refP);

  if (!snap.exists()) {
    await set(refP, {
      name: user.displayName,
      resources: { wood: 300, stone: 200, gold: 5 },
      army: { assassin: 10, tank: 5, archer: 5, cavalry: 3, flying: 0 }
    });
  }

  const d = (await get(refP)).val();

  $("game").style.display = "block";
  $("playerName").innerText = "Witaj, " + d.name;
  $("wood").innerText = d.resources.wood;
  $("stone").innerText = d.resources.stone;
  $("gold").innerText = d.resources.gold;

  $("a_assassin").innerText = d.army.assassin;
  $("a_tank").innerText = d.army.tank;
  $("a_archer").innerText = d.army.archer;
  $("a_cavalry").innerText = d.army.cavalry;
  $("a_flying").innerText = d.army.flying;

  onValue(ref(db, "players"), snap => {
    $("target").innerHTML = "";
    snap.forEach(p => {
      if (p.key !== user.uid) {
        const o = document.createElement("option");
        o.value = p.key;
        o.text = p.val().name;
        $("target").appendChild(o);
      }
    });
  });
});
</script>

</body>
</html>

























