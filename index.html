<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Fantasy Kingdom</title>
</head>
<body>

<button id="loginBtn">Zaloguj siÄ™</button>

<div id="game" style="display:none;">
<h2 id="playerName"></h2>

<h3>ğŸ“¦ Surowce</h3>
ğŸŒ² Drewno: <span id="wood">0</span><br>
ğŸª¨ KamieÅ„: <span id="stone">0</span><br>
ğŸ’ ZÅ‚oto: <span id="gold">0</span>

<hr>

<h3>ğŸ° Koszary</h3>
Poziom: <span id="barracksLevel">1</span><br>
<button onclick="upgradeBarracks()">Ulepsz koszary</button>

<hr>

<h3>ğŸª– Rekrutacja</h3>

<select id="unitType">
  <option value="assassin">Asasyn</option>
  <option value="tank">Tank</option>
  <option value="archer">Åucznik</option>
  <option value="cavalry">Kawaleria</option>
  <option value="flying">LatajÄ…ce</option>
</select>

<input type="number" id="amount" value="1" min="1">
<button onclick="recruit()">Rekrutuj</button>

<div id="recruitTimer"></div>

<hr>

<h3>âš”ï¸ Twoja armia</h3>
Asasyni: <span id="a_assassin">0</span><br>
Tanki: <span id="a_tank">0</span><br>
Åucznicy: <span id="a_archer">0</span><br>
Kawaleria: <span id="a_cavalry">0</span><br>
LatajÄ…ce: <span id="a_flying">0</span>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, get, set, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyChxX62dEqlQ4ZVexsp7MEtV2ZD7EiGWrs",
  authDomain: "fantasy-kingdom-70acd.firebaseapp.com",
  databaseURL: "https://fantasy-kingdom-70acd-default-rtdb.firebaseio.com",
  projectId: "fantasy-kingdom-70acd"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);
const provider = new GoogleAuthProvider();
const $ = id => document.getElementById(id);

$("loginBtn").onclick = () => signInWithPopup(auth, provider);

/* ğŸ§  TIER LOGIKA */
const tierUnlocked = (barracks, unit) => {
  if (unit === "flying") return barracks >= 5;
  return barracks >= 1;
};

/* ğŸ’° KOSZTY */
const unitCost = {
  assassin: { wood: 10, stone: 5 },
  tank: { wood: 20, stone: 20 },
  archer: { wood: 15, stone: 10 },
  cavalry: { wood: 30, stone: 20 },
  flying: { wood: 50, stone: 50 }
};

/* â± CZAS */
const unitTime = unit => 5000;

/* ğŸª– REKRUTACJA */
window.recruit = async () => {
  const user = auth.currentUser;
  const refP = ref(db, "players/" + user.uid);
  const d = (await get(refP)).val();

  if (d.recruiting) {
    alert("Rekrutacja w toku");
    return;
  }

  const unit = $("unitType").value;
  const amount = parseInt($("amount").value);

  if (!tierUnlocked(d.buildings.barracks.level, unit)) {
    alert("Ten tier jest zablokowany");
    return;
  }

  const cost = unitCost[unit];
  if (d.resources.wood < cost.wood * amount ||
      d.resources.stone < cost.stone * amount) {
    alert("Za maÅ‚o surowcÃ³w");
    return;
  }

  await update(refP, {
    "resources/wood": d.resources.wood - cost.wood * amount,
    "resources/stone": d.resources.stone - cost.stone * amount,
    recruiting: {
      unit,
      amount,
      end: Date.now() + unitTime(unit) * amount
    }
  });

  location.reload();
};

/* â³ SPRAWDZANIE REKRUTACJI */
async function checkRecruit(user) {
  const refP = ref(db, "players/" + user.uid);
  const d = (await get(refP)).val();
  if (!d.recruiting) return;

  if (Date.now() >= d.recruiting.end) {
    const u = d.recruiting.unit;
    await update(refP, {
      [`army/${u}`]: d.army[u] + d.recruiting.amount,
      recruiting: null
    });
  }
}

/* ğŸ° ULEPSZ KOSZARY */
window.upgradeBarracks = async () => {
  const user = auth.currentUser;
  const refP = ref(db, "players/" + user.uid);
  const d = (await get(refP)).val();

  const lvl = d.buildings.barracks.level;
  const cost = lvl * 100;

  if (d.resources.wood < cost) {
    alert("Za maÅ‚o drewna");
    return;
  }

  await update(refP, {
    "resources/wood": d.resources.wood - cost,
    "buildings/barracks/level": lvl + 1
  });

  location.reload();
};

/* ğŸ‘¤ START */
onAuthStateChanged(auth, async (user) => {
  if (!user) return;

  const refP = ref(db, "players/" + user.uid);
  let snap = await get(refP);

  if (!snap.exists()) {
    await set(refP, {
      name: user.displayName,
      resources: { wood: 500, stone: 300, gold: 5 },
      buildings: { barracks: { level: 1 } },
      army: {
        assassin: 0,
        tank: 0,
        archer: 0,
        cavalry: 0,
        flying: 0
      },
      recruiting: null
    });
  }

  await checkRecruit(user);
  const d = (await get(refP)).val();

  $("game").style.display = "block";
  $("playerName").innerText = "Witaj, " + d.name;

  $("wood").innerText = d.resources.wood;
  $("stone").innerText = d.resources.stone;
  $("gold").innerText = d.resources.gold;

  $("barracksLevel").innerText = d.buildings.barracks.level;

  $("a_assassin").innerText = d.army.assassin;
  $("a_tank").innerText = d.army.tank;
  $("a_archer").innerText = d.army.archer;
  $("a_cavalry").innerText = d.army.cavalry;
  $("a_flying").innerText = d.army.flying;

  if (d.recruiting) {
    setInterval(() => {
      const left = Math.max(0, Math.floor((d.recruiting.end - Date.now()) / 1000));
      $("recruitTimer").innerText = "Rekrutacja: " + left + "s";
    }, 1000);
  }
});
</script>

</body>
</html>





















