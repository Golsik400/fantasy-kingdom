<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Fantasy Kingdom</title>
</head>
<body>

<button id="loginBtn">Zaloguj siÄ™</button>

<div id="game" style="display:none;">
<h2 id="playerName"></h2>

<h3>ğŸ“¦ Surowce</h3>
ğŸŒ² Drewno: <span id="wood">0</span><br>
ğŸª¨ KamieÅ„: <span id="stone">0</span><br>
ğŸ’ ZÅ‚oto: <span id="gold">0</span>

<hr>

<h3>âš”ï¸ Armia</h3>
Asasyni: <span id="a_assassin">0</span><br>
Tanki: <span id="a_tank">0</span><br>
Åucznicy: <span id="a_archer">0</span><br>
Kawaleria: <span id="a_cavalry">0</span><br>
LatajÄ…ce: <span id="a_flying">0</span>

<hr>

<h3>ğŸ—ºï¸ PvE â€“ Potwory</h3>

<select id="monster">
  <option value="1">Goblin (lvl 1)</option>
  <option value="2">Ork (lvl 2)</option>
  <option value="3">Troll (lvl 3)</option>
  <option value="4">Smok (lvl 4)</option>
</select>

<button onclick="attack()">Atakuj</button>
<div id="battleLog"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, get, set, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyChxX62dEqlQ4ZVexsp7MEtV2ZD7EiGWrs",
  authDomain: "fantasy-kingdom-70acd.firebaseapp.com",
  databaseURL: "https://fantasy-kingdom-70acd-default-rtdb.firebaseio.com",
  projectId: "fantasy-kingdom-70acd"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);
const provider = new GoogleAuthProvider();
const $ = id => document.getElementById(id);

$("loginBtn").onclick = () => signInWithPopup(auth, provider);

/* ğŸ§® SIÅA JEDNOSTEK */
const power = {
  assassin: 2,
  tank: 5,
  archer: 3,
  cavalry: 4,
  flying: 8
};

/* ğŸ‘¹ POTWORY */
const monsters = {
  1: { name: "Goblin", power: 10, loot: { wood: 50, stone: 20 } },
  2: { name: "Ork", power: 30, loot: { wood: 100, stone: 50 } },
  3: { name: "Troll", power: 70, loot: { wood: 200, stone: 150 } },
  4: { name: "Smok", power: 150, loot: { wood: 500, stone: 300, gold: 1 } }
};

/* âš”ï¸ WALKA */
window.attack = async () => {
  const user = auth.currentUser;
  const refP = ref(db, "players/" + user.uid);
  const d = (await get(refP)).val();

  const m = monsters[$("monster").value];

  const armyPower =
    d.army.assassin * power.assassin +
    d.army.tank * power.tank +
    d.army.archer * power.archer +
    d.army.cavalry * power.cavalry +
    d.army.flying * power.flying;

  if (armyPower <= 0) {
    $("battleLog").innerText = "Nie masz armii!";
    return;
  }

  if (armyPower >= m.power) {
    await update(refP, {
      "resources/wood": d.resources.wood + (m.loot.wood || 0),
      "resources/stone": d.resources.stone + (m.loot.stone || 0),
      "resources/gold": d.resources.gold + (m.loot.gold || 0)
    });

    $("battleLog").innerText =
      "ZwyciÄ™stwo nad " + m.name + "! Zdobyto Å‚upy.";
  } else {
    await update(refP, {
      "army/assassin": Math.floor(d.army.assassin * 0.7),
      "army/tank": Math.floor(d.army.tank * 0.7),
      "army/archer": Math.floor(d.army.archer * 0.7),
      "army/cavalry": Math.floor(d.army.cavalry * 0.7),
      "army/flying": Math.floor(d.army.flying * 0.7)
    });

    $("battleLog").innerText =
      "PoraÅ¼ka! Armia poniosÅ‚a straty.";
  }

  location.reload();
};

/* ğŸ‘¤ START */
onAuthStateChanged(auth, async (user) => {
  if (!user) return;

  const refP = ref(db, "players/" + user.uid);
  let snap = await get(refP);

  if (!snap.exists()) {
    await set(refP, {
      name: user.displayName,
      resources: { wood: 200, stone: 100, gold: 5 },
      army: {
        assassin: 10,
        tank: 5,
        archer: 5,
        cavalry: 3,
        flying: 0
      }
    });
  }

  const d = (await get(refP)).val();

  $("game").style.display = "block";
  $("playerName").innerText = "Witaj, " + d.name;

  $("wood").innerText = d.resources.wood;
  $("stone").innerText = d.resources.stone;
  $("gold").innerText = d.resources.gold;

  $("a_assassin").innerText = d.army.assassin;
  $("a_tank").innerText = d.army.tank;
  $("a_archer").innerText = d.army.archer;
  $("a_cavalry").innerText = d.army.cavalry;
  $("a_flying").innerText = d.army.flying;
});
</script>

</body>
</html>























