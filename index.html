<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Fantasy Kingdom MMO</title>
<style>
body{font-family:Arial;background:#111;color:#eee}
.card{border:1px solid #444;padding:10px;margin:10px}
#chat,#clanChat{height:120px;overflow:auto;background:#000;padding:5px}
.msg{font-size:13px}
button,input,select{margin:3px}
</style>
</head>
<body>

<button id="login">Zaloguj</button>

<div id="game" style="display:none">
<h2 id="name"></h2>

<div class="card">
<h3>ğŸ“¦ Surowce</h3>
ğŸŒ² <span id="wood"></span>
ğŸª¨ <span id="stone"></span>
ğŸ’ <span id="gold"></span>
</div>

<div class="card">
<h3>ğŸ’¬ Czat globalny</h3>
<div id="chat"></div>
<input id="chatInput"><button onclick="sendGlobal()">WyÅ›lij</button>
</div>

<div class="card">
<h3>ğŸ° Klan</h3>
<div id="clanInfo">Brak klanu</div>

<h4>Czat klanowy</h4>
<div id="clanChat"></div>
<input id="clanInput"><button onclick="sendClan()">WyÅ›lij</button>
</div>

<div class="card">
<h3>ğŸ‘¹ World Boss</h3>
HP: <span id="bossHp"></span><br>
<button onclick="attackBoss()">Atakuj Bossa</button>
<div id="bossLog"></div>
</div>

<div class="card">
<h3>ğŸ’ Sklep premium PRO</h3>
<button onclick="buy('wood')">+1000 drewna (1ğŸ’)</button>
<button onclick="buy('army')">+10 wojska (1ğŸ’)</button>
<button onclick="buy('shield')">Reset ochrony (2ğŸ’)</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
import { getDatabase, ref, set, get, push, update, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

const app = initializeApp({
 apiKey:"AIzaSyChxX62dEqlQ4ZVexsp7MEtV2ZD7EiGWrs",
 authDomain:"fantasy-kingdom-70acd.firebaseapp.com",
 databaseURL:"https://fantasy-kingdom-70acd-default-rtdb.firebaseio.com",
 projectId:"fantasy-kingdom-70acd"
});

const auth=getAuth(app);
const db=getDatabase(app);
const provider=new GoogleAuthProvider();
const $=i=>document.getElementById(i);

$("login").onclick=()=>signInWithPopup(auth,provider);

/* ğŸ’¬ CHAT */
window.sendGlobal=()=>push(ref(db,"chat"),{
 name:auth.currentUser.displayName,
 text:$("chatInput").value,
 time:Date.now()
});

/* ğŸ° KLAN CHAT */
window.sendClan=async()=>{
 const p=(await get(ref(db,"players/"+auth.currentUser.uid))).val();
 if(!p.clan)return;
 push(ref(db,"clanChats/"+p.clan),{
  name:p.name,text:$("clanInput").value,time:Date.now()
 });
};

/* ğŸ‘¹ WORLD BOSS */
window.attackBoss=async()=>{
 const dmg=10;
 runTransaction(ref(db,"worldBoss/hp"),hp=>{
  if(hp>0)return hp-dmg;
  return hp;
 });
 $("bossLog").innerText="ZadaÅ‚eÅ› "+dmg+" obraÅ¼eÅ„!";
};

/* ğŸ’ SKLEP */
window.buy=async(type)=>{
 const r=ref(db,"players/"+auth.currentUser.uid);
 const p=(await get(r)).val();
 if(p.resources.gold<1)return alert("Brak ğŸ’");
 if(type==="wood")await update(r,{
  "resources/wood":p.resources.wood+1000,
  "resources/gold":p.resources.gold-1
 });
 if(type==="army")await update(r,{
  "army/assassin":(p.army?.assassin||0)+10,
  "resources/gold":p.resources.gold-1
 });
};

/* START */
onAuthStateChanged(auth,async u=>{
 if(!u)return;
 const r=ref(db,"players/"+u.uid);
 if(!(await get(r)).exists()){
  await set(r,{
   name:u.displayName,
   clan:null,
   resources:{wood:500,stone:300,gold:5},
   army:{assassin:10}
  });
 }
 $("game").style.display="block";
 const d=(await get(r)).val();
 $("name").innerText=d.name;
 $("wood").innerText=d.resources.wood;
 $("stone").innerText=d.resources.stone;
 $("gold").innerText=d.resources.gold;
 if(d.clan)$("clanInfo").innerText="Klan: "+d.clan;

 onValue(ref(db,"chat"),s=>{
  $("chat").innerHTML="";
  s.forEach(m=>{
   $("chat").innerHTML+=`<div class="msg">${m.val().name}: ${m.val().text}</div>`;
  });
 });

 onValue(ref(db,"worldBoss"),s=>{
  if(!s.exists())set(ref(db,"worldBoss"),{hp:1000000});
  $("bossHp").innerText=s.val().hp;
 });

 if(d.clan){
  onValue(ref(db,"clanChats/"+d.clan),s=>{
   $("clanChat").innerHTML="";
   s.forEach(m=>{
    $("clanChat").innerHTML+=`<div class="msg">${m.val().name}: ${m.val().text}</div>`;
   });
  });
 }
});
</script>
</body>
</html>































